<!DOCTYPE html>

<head>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script>
        var memo = [];
        window.onload = function () {
            var btn = document.getElementById('btn');
            var cnt = document.getElementById('cnt');
            btn.addEventListener('click', function () {
                var rec = { 'id': memo.length + 1, 'date': new Date(), 'note': cnt.value };
                addItem(rec);
                $.ajax({
                    url: 'https://js-basic.herokuapp.com/k9102/notes',
                    type: 'post',
                    data: rec,
                    success: function (data) {
                        console.log(data);
                    }
                });

            });
        }

        function addItem(rec) {
            console.log(rec);
            memo.push(rec);
            $("#header").after(
                `<tr><td>${rec.date.toLocaleString('en-US',{ hour12: false })}</td><td>${rec.note}</td>` +
                `<th><input type="button" class="remove" value="삭제" id="${rec.id}"></th>` +
                "</tr>"
            );
            cnt.value = "";

            $(`#${rec.id}`).on("click", function () {
                var pos = parseInt(this.id) - 1;
                memo.splice(pos, 1);
                $(this).parent().parent().remove();
                $.ajax({
                    method: "DELETE",
                    url: `https://js-basic.herokuapp.com/k9102/notes/${rec.id}`,
                }).done(function (msg) {
                    console.log(`delete #${rec.id}`);
                    console.log(msg)
                });
            });
        }
    </script>
</head>

<body>
    <h1>심플메모</h1>
    <p>메모를 입력하세요</p>
    <input type="text" id="cnt">
    <input type="button" id="btn" value="저장">
    <table id="tbl">
        <tr id="header">
            <th>날짜</th>
            <th>메모</th>
        </tr>
    </table>
    <script>
        $.ajax({
            method: "GET",
            url: "https://js-basic.herokuapp.com/k9102/notes",
            dataType: 'json'
        }).done(function (msg) {
            console.log(msg);
            recs = msg.results;
            for (i in recs) {
                var rec = { 'id': recs[i].id, 'date': new Date(recs[i].date), 'note': recs[i].note };
                memo.push(rec);
                addItem(rec);
            }
        });

    </script>
</body>