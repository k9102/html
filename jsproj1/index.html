<!DOCTYPE html>

<head>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script>
        function getId() {
            return Math.random().toString(36).substr(2, 9);
        }

        $(document).ready(function () {
            /* download notes from the server*/
            $.ajax({
                method: "GET",
                url: "https://js-basic.herokuapp.com/k9102/notes",
                dataType: 'json'
            }).done(function (msg) {
                console.log(msg);
                recs = msg.results;
                for (i in recs) {
                    var rec = { 'id': recs[i].id, 'date': new Date(recs[i].date), 'note': recs[i].note };
                    addItem(rec);
                }
            });

            /*attach the handler to "save" button*/
            $("#btn").on('click', function () {
                var rec = { 'id': getId(), 'date': new Date(), 'note': $('#cnt').val() };
                addItem(rec);
                /*upload a note to the server*/
                $.ajax({
                    url: 'https://js-basic.herokuapp.com/k9102/notes',
                    type: 'post',
                    data: rec,
                    success: function (data) {
                        console.log(data);
                    }
                });

            });
        });

        function addItem(rec) {
            console.log(rec);
            /*show a note to the screen*/
            $("#header").after(
                `<tr><td>${rec.date.toLocaleString('en-US', { hour12: false })}</td><td>${rec.note}</td>` +
                `<th><input type="button" class="remove" value="삭제" id="${rec.id}"></th>` +
                "</tr>"
            );

            /*clear edit box*/
            cnt.value = "";

            /*attach the handler to "remove" button*/
            $(`#${rec.id}`).on("click", function () {
                $(this).parent().parent().remove();
                $.ajax({
                    method: "DELETE",
                    url: `https://js-basic.herokuapp.com/k9102/notes/${rec.id}`,
                }).done(function (msg) {
                    console.log(`delete #${rec.id}`);
                    console.log(msg)
                });
            });
        }
    </script>
</head>

<body>
    <h1>심플메모</h1>
    <p>메모를 입력하세요</p>
    <input type="text" id="cnt">
    <input type="button" id="btn" value="저장">
    <table id="tbl">
        <tr id="header">
            <th>날짜</th>
            <th>메모</th>
        </tr>
    </table>
</body>